<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Fotocopiados - UNAJ</title>
    <link rel="stylesheet" href="/Style.css">
    <!-- Agregando librería SheetJS para exportación a Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Cambiando a Firebase v9+ moderno con módulos ES6 -->
    <script type="module">
        // Importar Firebase v9+
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, off } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';
        
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC0YFv49AUWjZtEl2KxgiytnFG4bzv5sMA",
            authDomain: "fotocopiado-unaj.firebaseapp.com",
            databaseURL: "https://fotocopiado-unaj-default-rtdb.firebaseio.com/",
            projectId: "fotocopiado-unaj",
            storageBucket: "fotocopiado-unaj.firebasestorage.app",
            messagingSenderId: "198572714385",
            appId: "1:198572714385:web:2ec73dfa4386daa47a5230",
            measurementId: "G-SNQ58PSQJ2"
        };
        
        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Hacer Firebase disponible globalmente
        window.firebaseApp = app;
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
        window.firebaseOff = off;
        window.firebaseInitialized = true;
        
        console.log("[v0] Firebase v9+ inicializado correctamente");
    </script>
</head>
<body>
    <!-- Pantalla de selección de fotocopiado -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>Sistema de Fotocopiados UNAJ</h1>
                <p>Selecciona tu fotocopiado e ingresa la contraseña</p>
            </div>
            
            <div class="fotocopiados-grid">
                <div class="fotocopiado-card" onclick="selectFotocopiado('salud')">
                    <!-- Corrigiendo ruta de imagen del Instituto de Salud -->
                    <div class="fotocopiado-icon">
                        <img src="/images/instituto-salud.png" alt="Instituto de Ciencias de la Salud" class="instituto-logo">
                    </div>
                    <h3>Copiados Salud</h3>
                    <p>Instituto de Salud</p>
                    <!-- Agregando sección de contraseña inline para cada perfil -->
                    <div id="passwordSection-salud" class="password-section-inline" style="display: none;">
                        <div class="password-card-inline">
                            <div class="password-input-group">
                                <input type="password" id="passwordInput-salud" placeholder="Ingresa la contraseña" class="password-input">
                                <button onclick="login('salud')" class="login-btn">Ingresar</button>
                            </div>
                            <button onclick="cancelLogin('salud')" class="cancel-btn">Cancelar</button>
                        </div>
                    </div>
                </div>
                
                <div class="fotocopiado-card" onclick="selectFotocopiado('sociales')">
                    <!-- Corrigiendo ruta de imagen del Instituto de Ciencias Sociales -->
                    <div class="fotocopiado-icon">
                        <img src="/images/instituto-sociales.png" alt="Instituto de Ciencias Sociales y Administración" class="instituto-logo">
                    </div>
                    <h3>Copiados Sociales</h3>
                    <p>Instituto de Ciencias Sociales</p>
                    <!-- Agregando sección de contraseña inline para cada perfil -->
                    <div id="passwordSection-sociales" class="password-section-inline" style="display: none;">
                        <div class="password-card-inline">
                            <div class="password-input-group">
                                <input type="password" id="passwordInput-sociales" placeholder="Ingresa la contraseña" class="password-input">
                                <button onclick="login('sociales')" class="login-btn">Ingresar</button>
                            </div>
                            <button onclick="cancelLogin('sociales')" class="cancel-btn">Cancelar</button>
                        </div>
                    </div>
                </div>
                
                <div class="fotocopiado-card" onclick="selectFotocopiado('ingenieria')">
                    <!-- Corrigiendo ruta de imagen del Instituto de Ingeniería -->
                    <div class="fotocopiado-icon">
                        <img src="/images/instituto-ingenieria.png" alt="Instituto de Ingeniería y Agronomía" class="instituto-logo">
                    </div>
                    <h3>Copiados Ingeniería</h3>
                    <p>Instituto de Ingeniería</p>
                    <!-- Agregando sección de contraseña inline para cada perfil -->
                    <div id="passwordSection-ingenieria" class="password-section-inline" style="display: none;">
                        <div class="password-card-inline">
                            <div class="password-input-group">
                                <input type="password" id="passwordInput-ingenieria" placeholder="Ingresa la contraseña" class="password-input">
                                <button onclick="login('ingenieria')" class="login-btn">Ingresar</button>
                            </div>
                            <button onclick="cancelLogin('ingenieria')" class="cancel-btn">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sistema de calculadora con header actualizado -->
    <div id="calculatorScreen" class="calculadora-container" style="display: none;">
        <div class="calculadora-wrapper">
            <header class="calc-header">
                <div class="calc-header-content">
                    <div class="calc-header-text">
                        <h1 id="fotocopiadoTitle">Calculadora de cobro</h1>
                        <p id="fotocopiadoSubtitle">Sistema para empleados - Cálculo de impresiones</p>
                    </div>
                    <div class="header-controls">
                        <!-- Simplificando estructura del botón de tema -->
                        <button id="calcThemeToggle" class="calc-theme-toggle" onclick="calcToggleTheme()" title="Cambiar tema">
                            <span class="calc-theme-icon calc-sun-icon"></span>
                            <span class="calc-theme-icon calc-moon-icon"></span>
                        </button>
                        <button onclick="logout()" class="logout-btn" title="Cerrar sesión">
                            <span>🚪</span> Salir
                        </button>
                    </div>
                </div>
            </header>

            <div id="calcMainContent">
                <!-- Configuración de precio -->
                <div class="calc-card">
                    <div class="calc-card-header">
                        <div class="calc-card-title">
                            Configuración de Precios
                        </div>
                    </div>
                    <div class="calc-card-content">
                        <div class="calc-grid calc-grid-cols-2" style="margin-bottom: 20px;">
                            <div>
                                <label class="calc-label">Precio hoja blanco y negro:</label>
                                <div class="calc-flex">
                                    <input type="number" id="calcPrecioHoja" value="40" min="1" class="calc-input calc-input-small">
                                    <span style="color: var(--text-secondary);">pesos</span>
                                </div>
                            </div>
                            <div>
                                <label class="calc-label">Precio hoja a color:</label>
                                <div class="calc-flex">
                                    <input type="number" id="calcPrecioHojaColor" value="80" min="1" class="calc-input calc-input-small">
                                    <span style="color: var(--text-secondary);">pesos</span>
                                </div>
                            </div>
                        </div>
                        <div class="calc-flex">
                            <button onclick="calcAgregarArchivo()" class="calc-btn calc-btn-primary">
                                Agregar Archivo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Container de archivos -->
                <div id="calcArchivosContainer"></div>

                <!-- Botón calcular total -->
                <div style="text-align: center; margin: 30px 0;">
                    <!-- Agregando contenedor flex para botones Calcular Total y Cancelar Venta -->
                    <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="calcCalcularTotal()" class="calc-btn calc-btn-primary" style="padding: 16px 32px; font-size: 1.1rem;">
                           Calcular Total
                        </button>
                        <button onclick="calcCancelarVenta()" class="calc-btn calc-btn-secondary" style="padding: 16px 32px; font-size: 1.1rem;">
                           Cancelar Venta
                        </button>
                    </div>
                </div>

                <!-- Resultado y pago -->
                <div id="calcPagoContainer" class="calc-card calc-pago-card" style="display:none;">
                    <div class="calc-card-header">
                        <div class="calc-card-title" style="color: #059669;">
                            Resumen de Venta
                        </div>
                    </div>
                    <div class="calc-card-content">
                        <div id="calcTotalDisplay" class="calc-total-display"></div>
                        
                        <div style="border-top: 1px solid var(--border-color); padding-top: 20px;">
                            <label class="calc-label">Método de pago:</label>
                            <div class="calc-checkbox-group">
                                <label class="calc-checkbox-item">
                                    <input type="checkbox" id="calcEfectivo" class="calc-checkbox" onchange="calcSeleccionarMetodo('efectivo')">
                                    <span>Efectivo</span>
                                </label>
                                <label class="calc-checkbox-item">
                                    <input type="checkbox" id="calcTransferencia" class="calc-checkbox" onchange="calcSeleccionarMetodo('transferencia')">
                                    <span>Transferencia</span>
                                </label>
                            </div>
                        </div>

                        <div class="calc-flex" style="margin: 20px 0;">
                            <label class="calc-label">Dinero que entrega el cliente:</label>
                            <input type="number" id="calcDineroCliente" placeholder="Ingrese el monto" class="calc-input calc-input-small">
                            <button onclick="calcCalcularCambio()" class="calc-btn calc-btn-secondary">
                                Calcular Cambio
                            </button>
                        </div>

                        <div id="calcResultadoCambio" style="display:none;"></div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="calcFinalizarVenta()" class="calc-btn calc-btn-success" style="padding: 12px 24px; font-size: 1.1rem;" id="calcBtnFinalizar" disabled>
                                Finalizar Venta
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabla de registro de ventas -->
            <div class="calc-card">
                <div class="calc-card-header">
                    <div class="calc-flex-between">
                        <div class="calc-card-title">
                            Registro de Ventas del Día
                            <!-- Agregando indicador de sincronización -->
                            <span id="syncStatus" class="sync-indicator" title="Estado de sincronización">🔄</span>
                        </div>
                        <div class="calc-flex" style="gap: 12px;">
                            <button onclick="calcExportarExcel()" class="calc-btn calc-btn-outline">
                                Exportar Excel
                            </button>
                        </div>
                    </div>
                </div>
                <div class="calc-card-content">
                    <!-- Tabla Desktop -->
                    <table class="calc-table">
                        <thead>
                            <tr>
                                <th>Método de Pago</th>
                                <th style="text-align: right;">Total Acumulado</th>
                                <th style="text-align: center;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Efectivo</td>
                                <td style="text-align: right; font-family: monospace; font-size: 1.1rem;" id="calcTotalEfectivo">$0</td>
                                <td style="text-align: center;">
                                    <!-- Cambiando "Ver" por "Ver detalles" para consistencia -->
                                    <button onclick="calcMostrarDetalles('efectivo')" class="calc-btn calc-btn-outline" style="padding: 6px 12px; font-size: 0.9rem;">
                                        Ver detalles (<span id="calcCountEfectivo">0</span>)
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Transferencia</td>
                                <td style="text-align: right; font-family: monospace; font-size: 1.1rem;" id="calcTotalTransferencia">$0</td>
                                <td style="text-align: center;">
                                    <button onclick="calcMostrarDetalles('transferencia')" class="calc-btn calc-btn-outline" style="padding: 6px 12px; font-size: 0.9rem;">
                                        Ver detalles (<span id="calcCountTransferencia">0</span>)
                                    </button>
                                </td>
                            </tr>
                            <tr class="calc-table-total">
                                <td>Total General</td>
                                <td style="text-align: right; font-family: monospace; font-size: 1.2rem;" id="calcTotalGeneral">$0</td>
                                <td style="text-align: center;">
                                    <span style="font-size: 0.9rem; color: var(--text-secondary);" id="calcTotalVentas">0 ventas</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Cards Mobile -->
                    <div class="calc-table-mobile">
                        <div class="calc-mobile-card">
                            <div class="calc-mobile-card-header">
                                <span>Efectivo</span>
                                <span class="calc-mobile-card-total" id="calcTotalEfectivoMobile">$0</span>
                            </div>
                            <div class="calc-mobile-card-actions">
                                <button onclick="calcMostrarDetalles('efectivo')" class="calc-btn calc-btn-outline" style="padding: 8px 16px; font-size: 0.9rem;">
                                    Ver detalles (<span id="calcCountEfectivoMobile">0</span>)
                                </button>
                            </div>
                        </div>

                        <div class="calc-mobile-card">
                            <div class="calc-mobile-card-header">
                                <span>Transferencia</span>
                                <span class="calc-mobile-card-total" id="calcTotalTransferenciaMobile">$0</span>
                            </div>
                            <div class="calc-mobile-card-actions">
                                <button onclick="calcMostrarDetalles('transferencia')" class="calc-btn calc-btn-outline" style="padding: 8px 16px; font-size: 0.9rem;">
                                    Ver detalles (<span id="calcCountTransferenciaMobile">0</span>)
                                </button>
                            </div>
                        </div>

                        <div class="calc-mobile-card calc-mobile-total-card">
                            <div class="calc-mobile-card-header">
                                <span>Total General</span>
                                <span class="calc-mobile-card-total" id="calcTotalGeneralMobile">$0</span>
                            </div>
                            <div style="text-align: center; font-size: 0.9rem; color: var(--text-secondary);" id="calcTotalVentasMobile">0 ventas</div>
                        </div>
                    </div>

                    <!-- Agregado el botón Restablecer al final de la tarjeta -->
                    <div style="text-align: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <button onclick="calcRestablecerVentas()" class="calc-btn calc-btn-danger" style="padding: 12px 24px; font-size: 1rem;">
                            Restablecer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Detalles de ventas -->
            <div id="calcDetallesContainer" class="calc-card" style="display:none;">
                <div class="calc-card-header">
                    <div class="calc-flex-between">
                        <div class="calc-card-title" id="calcDetallesTitle">Detalles de Ventas</div>
                        <button onclick="calcOcultarDetalles()" class="calc-btn calc-btn-outline" style="padding: 6px 12px;">
                            Cerrar
                        </button>
                    </div>
                </div>
                <div class="calc-card-content">
                    <div id="calcDetallesContent" class="calc-detalles"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agregando footer con marca de agua que aparece en todas las pantallas -->
    <footer class="watermark-footer">
        <p>Web y software creados y diseñados por <a href="https://mauricioricotti.free.nf/?i=1" target="_blank" rel="noopener noreferrer">Mauricio Ricotti</a></p>
    </footer>

    <script src="/Code.js"></script>
</body>
</html>
